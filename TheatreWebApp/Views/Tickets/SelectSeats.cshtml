@using TheatreWebApp.Models.Tickets

@model BookingFormModel

@{
    ViewData["Title"] = "Book Seats";
}



<div class="col-sm-12 offset-lg-2 col-lg-8">
    <h1 class="text-center">@Model.PlayName</h1>

    <p class="text-center">@Model.StageName</p>

    <p class="text-center">@Model.Time</p>
</div>


@{
    var rowCount = 1;
    var currentRow = 1;
}


<form method="post">
    <div>
        @if (Model.StageName == "Big stage")
        {
            <div class="row justify-content-center mb-2">
                <div style="padding: 5px">
                    <button class="btn btn-primary" type="submit" name="currentPage" @(Model.CurrentPage == 1 ? "disabled" : string.Empty) value="1">Stalls</button>
                </div>

                <div style="padding: 5px">
                    <button class="btn btn-primary" type="submit" name="currentPage" @(Model.CurrentPage == 2 ? "disabled" : string.Empty) value="2">Gallery One</button>
                </div>

                <div style="padding: 5px">
                    <button class="btn btn-primary" type="submit" name="currentPage" @(Model.CurrentPage == 3 ? "disabled" : string.Empty) value="3">Gallery Three</button>
                </div>
            </div>
        }

        <input type="hidden" asp-for="PlayName" value="@Model.PlayName">
        <input type="hidden" asp-for="StageName" value="@Model.StageName">
        <input type="hidden" asp-for="Time" value="@Model.Time">
        <input type="hidden" asp-for="ShowId" value="@Model.ShowId">
        <input type="hidden" asp-for="CurrentPage" value="@Model.CurrentPage">
        @if (Model.SelectedSeats != null)
        {
            <input type="hidden" asp-for="SelectedSeats" value="@Model.SelectedSeats">
        }
    </div>

    @{
        var rowIndexMax = 0;
        var rowIndexMin = 0;
        var rowIndexIncrease = 0;
    }


    @foreach (var row in Model.Rows)
    {
        if (row == 1)
        {
            rowIndexMax = 20;
            rowIndexIncrease = 20;
        }
        else if (row == 16)
        {
            rowIndexMax = 30;
            rowIndexIncrease = 30;
        }
        else if (row == 21)
        {
            rowIndexMax = 25;
            rowIndexIncrease = 25;
        }


        @if (rowIndexMax > Model.Seats.Count())
        {
            rowIndexMax = Model.Seats.Count();
        }

        if (row > 15 && row < 21)
        {
            <div class="row justify-content-center">

                <div style="padding: 5px">

                    @for (int i = rowIndexMin; i < rowIndexMax; i++)
                    {
                        if (i < rowIndexMin + 10)
                        {
                            if (Model.Seats[i].IsTaken)
                            {
                                <button class="btn btn-warning" type="submit" disabled name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else if (Model.Seats[i].IsSelected)
                            {
                                <button class="btn btn-primary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else
                            {
                                <button class="btn btn-secondary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                        }
                        else if (i > rowIndexMin + 20)
                        {
                            if (Model.Seats[i].IsTaken)
                            {
                                <button class="btn btn-warning" type="submit" disabled name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else if (Model.Seats[i].IsSelected)
                            {
                                <button class="btn btn-primary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else
                            {
                                <button class="btn btn-secondary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                        }
                        else
                        {
                              <span></span>
                        }

                    }

                </div>
            </div>


            <div class="row justify-content-center">

                <div style="padding: 5px">

                    @for (int i = rowIndexMin; i < rowIndexMax; i++)
                    {
                        if (i < rowIndexMin + 10)
                        {
                               <span></span>
                        }
                        else if (i > rowIndexMin + 20)
                        {

                        }
                        else
                        {
                            if (Model.Seats[i].IsTaken)
                            {
                                <button class="btn btn-warning" type="submit" disabled name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else if (Model.Seats[i].IsSelected)
                            {
                                <button class="btn btn-primary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                            else
                            {
                                <button class="btn btn-secondary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                            }
                        }

                    }

                </div>
            </div>
        }


        if (row < 16 || row > 20)
        {
            <div class="row justify-content-center">

                <div style="padding: 5px">

                    @for (int i = rowIndexMin; i < rowIndexMax; i++)
                    {
                        if (Model.Seats[i].IsTaken)
                        {
                            <button class="btn btn-warning" type="submit" disabled name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                        }
                        else if (Model.Seats[i].IsSelected)
                        {
                            <button class="btn btn-primary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                        }
                        else
                        {
                            <button class="btn btn-secondary" type="submit" name="SelectedSeatId" value="@Model.Seats[i].Id">@Model.Seats[i].Row</button>
                        }

                    }

                </div>

            </div>
        }


        rowIndexMin = rowIndexMax;
        rowIndexMax = rowIndexMax + rowIndexIncrease;

    }
</form>

<div class="row justify-content-center mt-2">
    <a class="btn btn-primary"  asp-controller="Tickets" asp-action="Review" asp-route-showId="@Model.ShowId" asp-route-selectedSeats="@Model.SelectedSeats">Book Seats</a>
</div>
